{% extends 'base.html' %} {% load static %} {% block content %}
{% load custom_filters %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-xl-12">
          <div class="card card-height-100 border-0 overflow-hidden">
            <div class="card-body p-0">
              <div class="row g-0">
               
                <!-- end col -->
                <div class="col-md-3">
                  <!-- card -->
                  <div class="card shadow-none  border-end-md  rounded-0 mb-0">
                    <div class="card-body">
                      <div class="dropdown float-end">
                        <a
                          class="text-reset dropdown-btn"
                          href="#"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          <span class="text-muted fs-lg"
                            ><i class="mdi mdi-dots-vertical align-middle"></i
                          ></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end" >
                          <a class="dropdown-item" href="#"  style="font-family: sans-serif;" >Today</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Week</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Month</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Current Year</a>
                        </div>
                      </div>
                      <div class="avatar-sm">
                        <span
                          class="avatar-title bg-dark-subtle text-dark rounded-circle fs-3"
                        >
                          <i class="ph-bag"></i>
                        </span>
                      </div>
                      <div class="mt-4">
                        <p class="text-uppercase fw-bold  text-truncate fs-sm" style="font-family: serif; color:#002147;">Orders</p>

                        <h4 class="fw-semibold mb-3">
                          <span class="counter-value" data-target="{{total_orders}}">0</span>
                        </h4>
                        <div class="d-flex flex-wrap align-items-center gap-2">
                          <h5 class="text-success fs-xs mb-0">
                            <i
                              class="ri-arrow-right-up-line fs-sm align-middle"
                            style="font-family: sans-serif;"></i>
                            +8.13 %
                          </h5>
                          <p class="text-muted mb-0" style="font-family: sans-serif;">than last week</p>
                        </div>
                      </div>
                    </div>
                    <!-- end card body -->
                  </div>
                  <!-- end card -->
                </div>
                <!-- end col -->
                <div class="col-md-3">
                  <!-- card -->
                  <div class="card shadow-none  border-end-md rounded-0 mb-0">
                    <div class="card-body">
                      <div class="dropdown float-end">
                        <a
                          class="text-reset dropdown-btn"
                          href="#"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          <span class="text-muted fs-lg"
                            ><i class="mdi mdi-dots-vertical align-middle"></i
                          ></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Today</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Week</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Month</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Current Year</a>
                        </div>
                      </div>
                      <div class="avatar-sm">
                        <span
                          class="avatar-title bg-light text-body rounded-circle fs-3"
                        >
                          <i class="ph-eye"></i>
                        </span>
                      </div>
                      <div class="mt-4">
                        <p
                          class="text-uppercase  fw-bold  text-truncate fs-sm"
                        style="font-family: serif;  color:#002147;">
                          Products
                        </p>
                        <h4 class="fw-semibold mb-3">
                          <span class="counter-value" data-target="{{total_products}}"
                            >0</span
                          >
                        </h4>
                        <div class="d-flex flex-wrap align-items-center gap-2">
                          <h5 class="text-danger fs-xs mb-0">
                            <i
                              class="ri-arrow-right-down-line fs-sm align-middle"
                            ></i>
                            +2.01 %
                          </h5>
                          <p class="text-muted mb-0" style="font-family: sans-serif;">than last week</p>
                        </div>
                      </div>
                    </div>
                    <!-- end card body -->
                  </div>
                  <!-- end card -->
                </div>
                <!-- end col -->

                <div class="col-md-3">
                  <!-- card -->
                  <div
                    class="card shadow-none  border-end-md border-top border-top-md-0 rounded-0 mb-0"
                  >
                    <div class="card-body">
                      <div class="dropdown float-end">
                        <a
                          class="text-reset dropdown-btn"
                          href="#"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          <span class="text-muted fs-lg"
                            ><i class="mdi mdi-dots-vertical align-middle"></i
                          ></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Today</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Week</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Month</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Current Year</a>
                        </div>
                      </div>
                      <div class="avatar-sm">
                        <span
                          class="avatar-title bg-info-subtle text-info rounded-circle fs-3"
                        >
                          <i class="ph-users-three"></i>
                        </span>
                      </div>
                      <div class="mt-4">
                        <p
                          class="text-uppercase  fw-bold  text-truncate fs-sm"
                        style="font-family: serif;  color:#002147;">
                          Customers
                        </p>
                        <h4 class="fw-semibold mb-3">
                          <span class="counter-value" data-target="{{total_customers}}">0</span
                          >
                        </h4>
                        <div class="d-flex flex-wrap align-items-center gap-2">
                          <h5 class="text-success fs-xs mb-0">
                            <i
                              class="ri-arrow-right-up-line fs-sm align-middle"
                            ></i>
                            +10.42 %
                          </h5>
                          <p class="text-muted mb-0" style="font-family: sans-serif;">than last week</p>
                        </div>
                      </div>
                    </div>
                    <!-- end card body -->
                  </div>
                  <!-- end card -->
                </div>
                <!-- end col -->
                  <div class="col-md-3">
                  <!-- card -->
                  <div
                    class="card shadow-none  rounded-0 mb-0"
                  >
                    <div class="card-body">
                      <div class="dropdown float-end">
                        <a
                          class="text-reset dropdown-btn"
                          href="#"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false"
                        >
                          <span class="text-muted fs-lg"
                            ><i class="mdi mdi-dots-vertical align-middle"></i
                          ></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end">
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Today</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Week</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Last Month</a>
                          <a class="dropdown-item" href="#" style="font-family: sans-serif;">Current Year</a>
                        </div>
                      </div>
                      <div class="avatar-sm">
                        <span
                          class="avatar-title bg-primary-subtle text-primary rounded-circle fs-3"
                        >
                          <i class="ph-wallet"></i>
                        </span>
                      </div>
                      <div class="mt-4">
                        <p
                          class="text-uppercase  fw-bold  text-truncate fs-sm"
                         style="font-family: serif;  color:#002147;">
                          Total Revenue
                        </p>
                        <h4 class="fw-semibold mb-3">
                          ₹&nbsp;<span class="counter-value" data-target="{{total_revenue}}"
                            >0</span
                          >
                        </h4>
                        <div class="d-flex flex-wrap align-items-center gap-2">
                          <h5 class="text-success fs-xs mb-0">
                            <i
                              class="ri-arrow-right-up-line fs-sm align-middle"
                            ></i>
                            +19.07 %
                          </h5>
                          <p class="text-muted mb-0" style="font-family: sans-serif;">than last week</p>
                        </div>
                      </div>
                    </div>
                    <!-- end card body -->
                  </div>
                  <!-- end card -->
                </div>
              </div>
              <!-- end row-->
            </div>
          </div>
        </div>
        <!--end col-->
        <div class="col-xl-12">
          <div class="card">
            <div class="row g-0">
              <div class="col-xl-9">
                <div class="card-header border-0 align-items-center d-flex">
                  <h4 class="card-title mb-0 flex-grow-1 fs-BOLD" style="font-family:serif;  color:#002147;">REVENUE</h4>
                  <div>
                    <button
                      type="button"
                      class="btn btn-subtle-secondary btn-sm"
                    >
                      ALL
                    </button>
                    <button
                      type="button"
                      class="btn btn-subtle-secondary btn-sm"
                    >
                      1M
                    </button>
                    <button
                      type="button"
                      class="btn btn-subtle-secondary btn-sm"
                    >
                      6M
                    </button>
                    <button type="button" class="btn btn-subtle-primary btn-sm">
                      1Y
                    </button>
                  </div>
                </div>
                <!-- end card header -->
                <div class="card-body ps-0">
                  <div class="w-100">
                    <div
                      id="market-overview"
                      data-colors='["--tb-primary", "--tb-secondary"]'
                      class="apex-charts"
                      dir="ltr"
                    ></div>
                  </div>
                </div>
                <!-- end card body -->
              </div>
              <div class="col-xl-3">
                <div
                  class="card-body border-start-xl border-top border-top-xl-0 border-2 h-100"
                >
                  <div>
                    <p class="text-muted mb-2">Budget (USD)</p>
                    <h4>
                      ₹750.36M
                      <small class="text-success fs-sm fw-normal"
                        ><i class="ph-arrow-up align-baseline"></i> 2.17%</small
                      >
                    </h4>
                    <p class="text-muted text-truncate" style="font-family:sans-serif;">
                      Budget in than last years
                    </p>
                    <div class="mx-3">
                      <div
                        id="mini-chart-6"
                        data-colors='["--tb-primary"]'
                        class="apex-charts"
                        dir="ltr"
                      ></div>
                    </div>
                  </div>

                  <div class="mt-4">
                    <p class="text-muted mb-2" >Payouts (USD)</p>
                    <h4>
                      ₹7,45,123
                      <small class="text-danger fs-sm fw-normal"
                        ><i class="ph-arrow-down align-baseline"></i>
                        -1.36%</small
                      >
                    </h4>
                    <p class="text-muted text-truncate"  style="font-family:sans-serif;">
                      Payouts in than last years
                    </p>
                    <div class="mx-3">
                      <div
                        id="mini-chart-7"
                        data-colors='["--tb-info"]'
                        class="apex-charts"
                        dir="ltr"
                      ></div>
                    </div>
                  </div>
                  <div class="mt-4">
                    <button
                      type="button"
                      class="btn btn-primary w-100 fs-lg"
                      data-bs-toggle="modal"
                      data-bs-target="#addAmount"
                      style="font-family:serif;background-color:#002147;border-color:#002147;">
                      Add Amount
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- end card -->
        </div>
        <!-- end col -->
      </div>
      <!--end row-->

     

      <div class="row">
        <div class="col-lg-12">
          <div class="card" id="contactList">
            <div class="card-header align-items-center d-flex">
              <h4 class="card-title mb-0 flex-grow-1 fs-bold" style="font-family:serif;">Latest Orders</h4>
              <div class="flex-shrink-0">
                <div class="dropdown card-header-dropdown sortble-dropdown flex-shrink-0">
                        <a class="text-reset dropdown-btn" href="#" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="text-muted dropdown-title" id="sort-title">Order Date</span> <i class="mdi mdi-chevron-down ms-1"></i></a>
                        <div class="dropdown-menu dropdown-menu-end">
                          <button class="dropdown-item sort" data-sort="order_date">Order Date</button>
                          <button class="dropdown-item sort" data-sort="order_id">Order ID</button>
                          <button class="dropdown-item sort" data-sort="amount">Amount</button>
                          <button class="dropdown-item sort" data-sort="customer">Customer</button>
                          <button class="dropdown-item sort" data-sort="payment_method">Payment Method</button>
                          <button class="dropdown-item sort" data-sort="status">Status</button>
                        </div>
                      </div>
              </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                  <!-- start table -->
                  <table class="table table-centered align-middle table-nowrap mb-0">
                    <thead class="text-muted table-light">
                      <tr>
                        <th>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="option" id="checkAll" />
                            <label class="form-check-label" for="checkAll"></label>
                          </div>
                        </th>
                        <th scope="col" class="cursor-pointer fs-lg" data-sort="order_id" style="font-family:serif; color:#002147;">Order ID</th>
                        <th scope="col" class="cursor-pointer fs-lg" data-sort="order_date" style="font-family:serif; color:#002147;">Order Date</th>
                        <th scope="col" class="cursor-pointer fs-lg" data-sort="products" style="font-family:serif;color:#002147;">Products</th>
                        <th scope="col" class="cursor-pointer fs-lg" data-sort="customer" style="font-family:serif;color:#002147;">Customer</th>
                        <th scope="col" class="cursor-pointer fs-lg" data-sort="payment_method" style="font-family:serif;color:#002147;">Payment Method</th>
                        <th scope="col" class="cursor-pointer fs-lg" data-sort="amount" style="font-family:serif;color:#002147;">Amount</th>
                        {% comment %} <th scope="col" class="sort cursor-pointer" data-sort="rating">Rating</th> {% endcomment %}
                       <th scope="col" class="cursor-pointer fs-lg" data-sort="status" style="font-family:serif;color:#002147;">Order Status</th>
                      </tr>
                    </thead>
                    <tbody class="list form-check-all" id="order-table-body">
                      {% for order in orders %}
                        <tr data-order-id="{{ order.order_number }}"
                          data-order-date="{{ order.created_at|date:'Y-m-d' }}"
                          data-delivery-date="
                                                        {% if order.status == 'delivered' %}
                            {{ order.updated_at|date:'Y-m-d' }}
                          {% elif order.items.first %}
                            {{ order.created_at|add_days:order.items.first.product.delivery_time_max|date:'Y-m-d' }}
                          {% else %}
                            {{ order.created_at|date:'Y-m-d' }}
                          {% endif %}
                                                    "
                          data-products="{% for item in order.items.all %}
                            {{ item.product.name }}{% if item.variant %}
                              
                              
                               ({{ item.variant.variant_value }})


                            {% endif %}
                            
                            


                            {% if not forloop.last %}, {% endif %}
                          {% endfor %}"
                          data-customer="{{ order.user.username }}"
                          data-payment-method="{% if order.payment %}
                            {{ order.payment.get_payment_method_display }}
                          {% else %}
                            
                            
                            COD


                          {% endif %}"
                          data-amount="{{ order.total_amount }}"
                          data-status="{{ order.get_status_display }}">
                          <th>
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" name="chk_child" value="{{ order.id }}" />
                              <label class="form-check-label"></label>
                            </div>
                          </th>
                          <td class="order_id" style="font-family:sans-serif;">
                            <a href="{% url 'dashboard:order_detail' order.order_number %}" class="fw-medium link-primary" style="font-family:sans-serif;">{{ order.order_number }}</a>
                          </td>
                          <td class="order_date">{{ order.created_at|date:'d M, Y' }}</td>
                          
                          <td class="products" style="font-family:sans-serif;">
                            {% with item=order.items.all.0 %}
                              {{ item.product.name|slice:':30' }}{% if item.variant.sizes %}
                                ({{ item.variant.color_name }})
                              {% endif %}
                            {% endwith %}
                          </td>
                          <td class="customer" style="font-family:sans-serif;">{{ order.user.username }}</td>
                          <td class="payment_method" style="font-family:sans-serif;">
                            {% if order.payment %}
                              {{ order.payment.get_payment_method_display }}
                            {% else %}
                              COD
                            {% endif %}
                          </td>
                          <td class="amount" style="font-family:sans-serif;">
                            <span class="fw-medium" style="font-family:sans-serif;">₹{{ order.total_amount }}</span>
                          </td>
                          {% comment %} <td class="rating">
                            <h5 class="fs-md fw-medium mb-0">
                              {% with avg_rating=order.items.first.product.average_rating %}
                                {% if avg_rating > 0 %}
                                  {{ avg_rating|floatformat:1 }}/5
                                {% else %}
                                  -
                                {% endif %}
                              {% endwith %}
                            </h5>
                          </td> {% endcomment %}
                         
                          <td class="status">
                            <span class="badge
                                {% if order.status == 'Delivered' or order.status == 'Confirmed' %}
                                    bg-success-subtle text-success
                                {% elif order.status == 'Processing' or order.status == 'Ready to Ship' %}
                                    bg-info-subtle text-info
                                {% elif order.status == 'Cancelled' or order.status == 'Refunded' %}
                                    bg-danger-subtle text-danger
                                {% else %}
                                    bg-warning-subtle text-warning
                                {% endif %}">
                                {{ order.status }}
                            </span>


                          </td>
                           
                        </tr>
                      {% empty %}
                        <tr>
                          <td colspan="11" class="text-center">No orders found</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <!-- end table -->
                  <div class="noresult" style="display: none">
                    <div class="text-center py-4">
                      <i class="ph-magnifying-glass fs-1 text-primary"></i>
                      <h5 class="mt-2">Sorry! No Result Found</h5>
                      <p class="text-muted mb-0">We've searched more than 150+ orders We did not find any orders for you search.</p>
                    </div>
                  </div>
                </div>
                <!-- Pagination -->
                <div class="d-flex justify-content-center justify-content-sm-end mt-2">
                  <div class="pagination-wrap hstack gap-2">
                    <a class="page-item pagination-prev {% if not page_obj.has_previous %}disabled{% endif %}"
                      href="{% if page_obj.has_previous %}
                        
                        
                        ?page={{ page_obj.previous_page_number }}{% if current_status %}
                          
                          
                          &status={{ current_status }}
                        {% endif %}
                      {% else %}
                        
                        
                        javascript:void(0)


                      {% endif %}">
                      <i class="mdi mdi-chevron-left align-middle" style="color:#002147;"></i>
                    </a>
                    <ul class="pagination listjs-pagination mb-0">
                      <!-- Show first page and ellipsis if needed -->
                      {% if page_obj.number > 3 %}
                        <li class="page-item">
                          <a class="page-link"
                            style="color:#002147;"
                            href="?page=1{% if current_status %}
                              
                              
                              &status={{ current_status }}
                            {% endif %}">
                            1
                          </a>
                        </li>
                        {% if page_obj.number > 4 %}
                          <li class="page-item disabled">
                            <span class="page-link">...</span>
                          </li>
                        {% endif %}
                      {% endif %}

                      <!-- Show pages around current page -->
                      {% for num in page_obj.paginator.page_range %}
                        {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
                          <li class="page-item  {% if page_obj.number == num %}active{% endif %}">
                            <a class="page-link"
                              style="background-color:#002147;border-color:#002147;"
                              href="?page={{ num }}{% if current_status %}
                                
                                
                                &status={{ current_status }}
                              {% endif %}">
                              {{ num }}
                            </a>
                          </li>
                        {% endif %}
                      {% endfor %}

                      <!-- Show ellipsis and last page if needed -->
                      {% with total_pages=page_obj.paginator.num_pages %}
                        {% if page_obj.number < total_pages|add:'- 2' %}
                          {% if page_obj.number < total_pages|add:'- 3' %}
                            <li class="page-item disabled">
                              <span class="page-link">...</span>
                            </li>
                          {% endif %}
                          <li class="page-item">
                            <a class="page-link"
                              style="color:#002147;"
                              href="?page={{ total_pages }}{% if current_status %}
                                
                                
                                &status={{ current_status }}
                              {% endif %}">
                              {{ total_pages }}
                            </a>
                          </li>
                        {% endif %}
                      {% endwith %}
                    </ul>
                    <a class="page-item pagination-next {% if not page_obj.has_next %}disabled{% endif %}"
                      href="{% if page_obj.has_next %}
                        
                        
                        ?page={{ page_obj.next_page_number }}{% if current_status %}
                          
                          
                          &status={{ current_status }}
                        {% endif %}
                      {% else %}
                        
                        
                        javascript:void(0)


                      {% endif %}">
                      <i class="mdi mdi-chevron-right align-middle" style="color:#002147;"></i>
                    </a>
                  </div>
                </div>
              </div>
          </div>
        </div>
        <!--end col-->
       
      </div>
      <!--end row-->

      
    </div>
    <!-- container-fluid -->
  </div>
  <!-- End Page-content -->
</div>
<!-- end main content-->
{% endblock content %}
