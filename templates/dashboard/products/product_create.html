{% extends 'base.html' %} 
{% load static %} 
{% block title %}
Products Create
{% endblock title %} 
{% block content %}

<div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <form action="{% url 'dashboard:product_create' %}" id="productDropzoneForm" method="post" class="row g-3" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!-- start page title -->
                        <div class="row">

                            <div class="col-12">

                                    {% if messages %}
                                    {% for message in messages %}
                                        <div
                                        class="alert alert-{{ message.tags }} alert-dismissible fade show mb-xl-0 mb-2"
                                        role="alert"
                                        id="alert-{{ forloop.counter }}"
                                        >
                                        <strong>{{ message }}..!</strong>
                                        <button
                                            type="button"
                                            class="btn-close"
                                            data-bs-dismiss="alert"
                                            aria-label="Close"
                                        ></button>
                                        </div>
                                    {% endfor %}
                                    {% endif %}
                                    

                                </div>


                            <div class="col-12 mt-3">
                                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                    <h4 class="mb-sm-0">Add Product</h4>

                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item">
                                            
                                                <button type="button" class="btn btn-primary " data-bs-toggle="modal" data-bs-target=".bs-example-modal-center">
                                                <i class="bi bi-plus-circle align-baseline me-1"></i>
                                                    Add Category
                                                </button>
                                                
                                               
                                            </li>
                                        </ol>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                        
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            
                                            <div class="col-xxl-12">
                                               
                                                    <div class="mb-3">
                                                        <label for="productTitle" class="form-label">Product Title <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" name="name" id="productTitle" placeholder="Enter product title" >
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label for="productCategories" class="form-label">Categories <span class="text-danger">*</span></label>
                                                                <select class="form-control" name="category" data-choices name="productCategories" id="productCategories" required>
                                                                    <option value="">Select categories</option>
                                                                    {% for category in categories %}
                                                                        <option value="{{ category.id }}">{{ category.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label for="subCategories" class="form-label">Sub Category <span class="text-danger">*</span></label>
                                                                <select class="form-control" name="subcategory"  id="subCategories" required>
                                                                    <option value="Men">Mens</option>
                                                                    <option value="Womens">Womens</option>
                                                                    <option value="Kids(Boys)">Kids(Boys)</option>
                                                                    <option value="Kids(Girls)">Kids(Girls)</option>
                                                                    
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label for="shortDecs" class="form-label"> Description <span class="text-danger">*</span></label>
                                                        <textarea class="form-control" name="description" id="shortDecs" placeholder="Must enter minimum of a 300 characters" rows="8"></textarea>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label for="productBrand" class="form-label">Brand <span class="text-danger">*</span></label>
                                                                <input type="text" name="brand" class="form-control" id="productBrand" placeholder="Enter brand" >
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label for="productBrand" class="form-label">Model name <span class="text-danger">*</span></label>
                                                                <input type="text" name="model_name" class="form-control" id="productBrand" placeholder="Enter brand" >
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label class="form-label" for="product-price-input">MRP Price <span class="text-danger">*</span></label>
                                                                <div class="input-group has-validation">
                                                                    <span class="input-group-text" id="product-price-addon">₹</span>
                                                                    <input type="number" class="form-control" name="product_mrp_price" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                                    <div class="invalid-feedback">Please Enter a MRP price.</div>
                                                                </div>
                                                            </div>
                                                        </div><!--end col-->
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label class="form-label" for="product-price-input">Selling Price <span class="text-danger">*</span></label>
                                                                <div class="input-group has-validation">
                                                                    <span class="input-group-text" id="product-price-addon">₹</span>
                                                                    <input type="number" name="product_selling_price" class="form-control" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                                    <div class="invalid-feedback">Please Enter a selling price.</div>
                                                                </div>
                                                            </div>
                                                        </div><!--end col-->
                                                    
                                                    </div>
                                                    
                                                    <div class="row mt-3">
                                                        <div class="col-lg-6">
                                                            <div class="form-check form-switch mb-3">
                                                                <input class="form-check-input" type="checkbox" name="cod_available"  id="exchangeableInput">
                                                                <label class="form-check-label" for="exchangeableInput">Cod Available</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="form-check form-switch mb-3">
                                                                <input class="form-check-input" type="checkbox" name="is_returnable"  id="refundableInput">
                                                                <label class="form-check-label" for="refundableInput">Returnable</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="form-check form-switch mb-3">
                                                                <input class="form-check-input" type="checkbox" name="is_free_shipping"  id="refundableInput">
                                                                <label class="form-check-label" for="refundableInput">Free Shipping</label>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>
                                                
                                            </div><!--end col-->
                                        </div><!--end row-->
                                    </div>
                                </div>
                            </div><!--end col-->
                        </div><!--end row-->

                    

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            
                                            <div class="col-xxl-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Product Images <span class="text-danger">*</span></label>
                                                    <div class="dropzone text-center" id="dropzoneArea">
                                                        <div class="fallback">
                                                            <input name="product_images" type="file" multiple>
                                                        </div>
                                                        <div class="dz-message needsclick">
                                                            <div class="mb-3">
                                                                <i class="display-4 text-muted ri-upload-cloud-2-fill"></i>
                                                            </div>
                                                            <h4>Drop product images here or click to upload.</h4>
                                                        </div>
                                                    </div>
                                                </div>

                                                
                                            </div>
                                        </div><!--end row-->
                                    </div>
                                </div>
                            </div><!--end col-->
                        </div><!--end row-->


                        
                        <div class="row">
                        
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            <h5 class="mb-3">Product Variants</h5>
                                            
                                            <div class="col-lg-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="product-price-input">MRP Price <span class="text-danger">*</span></label>
                                                    <div class="input-group has-validation">
                                                        <span class="input-group-text" id="product-price-addon">₹</span>
                                                        <input type="number" class="form-control" name="variant_mrp_price" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                        <div class="invalid-feedback">Please Enter a MRP price.</div>
                                                    </div>
                                                </div>
                                            </div><!--end col-->
                                            <div class="col-lg-6">
                                                <div class="mb-3">
                                                    <label class="form-label" for="product-price-input">Selling Price <span class="text-danger">*</span></label>
                                                    <div class="input-group has-validation">
                                                        <span class="input-group-text" id="product-price-addon">₹</span>
                                                        <input type="number" name="variant_selling_price" class="form-control" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                        <div class="invalid-feedback">Please Enter a selling price.</div>
                                                    </div>
                                                </div>
                                            </div><!--end col-->
                                            
                                            
                                            <div class="col-lg-6">
                                                <div class="mb-3">
                                                    <label for="productBrand" class="form-label">Image <span class="text-danger">*</span></label>
                                                    <input type="file" name="variant_image" class="form-control" id="productBrand"required>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="mb-3 ">
                                                    <label for="productBrand" class="form-label">Colour Code <span class="text-danger">*</span></label>
                                                    <div class="d-flex align-items-center">
                                                        <input type="color" name="hex_color_code" class="form-control form-control-color w-100" id="productColor" value="#000000" required>
                                                        <input type="text" class="form-control" name="hex_color_code" id="colorHexDisplay" readonly style="max-width: 120px;">

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="mb-3 ">
                                                    <label for="productBrand" class="form-label">Size <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                        <input type="text" style="text-transform: uppercase;" class="form-control" id="sizeInput" aria-label="Recipient's username" aria-describedby="button-addon2">
                                                        <button class="btn btn-info" type="button" id="button-addon2">Add</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="mb-3">
                                                    <label for="productBrand" class="form-label">Selected Size <span class="text-danger">*</span></label>
                                                    <br/>
                                                    <input type="hidden" name="variant_sizes" value="" id="selectedSize" required>
                                                    <div id="selectedSizeContainer"></div>
                                                </div>
                                            </div>
                                        
                                           <div class="col-lg-6">
                                                <div class="input-group">
                                                    <label class="input-group-text" for="inputGroupSelect01">Colors</label>
                                                    <select class="form-select" id="inputGroupSelect01" name="variant_value">
    
                                                        <option value="black">Black</option>
                                                        <option value="red">Red</option>
                                                        <option value="green">Green</option>
                                                        <option value="blue">Blue</option>
                                                        <option value="yellow">Yellow</option>
                                                        <option value="orange">Orange</option>
                                                        <option value="purple">Purple</option>
                                                        <option value="pink">Pink</option>
                                                        <option value="white">White</option>
                                                        <option value="gray">Gray</option>
                                                        <option value="brown">Brown</option>
                                                        <option value="violet">Violet</option>
                                                        <option value="indigo">Indigo</option>
                                                        <option value="cyan">Cyan</option>
                                                        <option value="magenta">Magenta</option>
                                                        <option value="gold">Gold</option>
                                                        <option value="silver">Silver</option>
                                                        <option value="beige">Beige</option>
                                                        <option value="maroon">Maroon</option>
                                                        <option value="navy">Navy</option>
                                                        <option value="teal">Teal</option>
                                                        <option value="lime">Lime</option>
                                                        <option value="olive">Olive</option>
                                                    </select>
                                                </div>
                                            </div>

                                            
                                        </div><!--end row-->

                                        <div class="hstack gap-2 justify-content-end mb-3">
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                            <button type="reset" class="btn btn-danger"><i class="ph-x align-middle"></i> Cancel</button>
                                            
                                        </div>


                                    </div>
                                </div>
                                
                            </div><!--end col-->

                            
                        </div><!--end row-->


                        
                    </form>
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
        <!--start back-to-top-->
            <button class="btn btn-dark btn-icon" id="back-to-top">
            <i class="bi bi-caret-up fs-3xl"></i>
            </button>
    <!--end back-to-top-->
        
        </div>
        <!-- end main content-->


<!-- Modal --> 
<div class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <h5 class="mb-3">Add New Category</h5>
                <form action="{% url 'dashboard:add_category' %}" method="post" class="row g-3" accept="multipart/form-data">
                {% csrf_token %}
                    <div class="col-md-12">
                        <label for="fullnameInput" class="form-label">Name
                            <span class="text-danger">*</span>
                        </label>
                        <input type="text" class="form-control" id="fullnameInput" name="name" placeholder="Enter name" required>
                    </div>
                               
                    <div class="col-12">
                        <label for="inputAddress" class="form-label">Description</label>
                        <input type="text" class="form-control" name="description" id="inputAddress" placeholder="Description">
                    </div>
                    <div class="col-12">
                        <label for="inputAddress" class="form-label">Image</label>
                        <input type="file" class="form-control" name="image" accept=".png,.jpeg,.jpg" id="inputAddress" >
                    </div>
                    
                    
                    <div class="col-12">
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">Create</button>
                        </div>
                    </div>
                </form>
                
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



    <!-- dropzone js -->
    <script src="{% static 'dashboard/libs/dropzone/dropzone-min.js' %}"></script>
    <!-- init js -->
    <script src="{% static 'dashboard/js/pages/ecommerce-create-product.init.js' %}"></script>


<script>
    const colorInput = document.getElementById('productColor');
    const colorHexDisplay = document.getElementById('colorHexDisplay');

    function updateColorCode() {
        colorHexDisplay.value = colorInput.value;
    }

    // Initialize
    updateColorCode();

    // Update on change
    colorInput.addEventListener('input', updateColorCode);
</script>

<!-- Include jQuery if not already included -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        let selectedSizes = [];

        $('#button-addon2').click(function () {
            let newSize = $('#sizeInput').val().trim();
            if (newSize !== "" && !selectedSizes.includes(newSize)) {
                selectedSizes.push(newSize);

                // Update the hidden input
                $('#selectedSize').val(selectedSizes.join(','));

                // Create and append the new button
                $('#selectedSizeContainer').append(`
                    <button type="button" class="btn rounded-pill btn-primary m-1">${newSize}</button>
                `);

                // Clear input
                $('#sizeInput').val('');
            }
        });
    });
</script>

<script>
Dropzone.autoDiscover = false; // avoid auto init

var myDropzone = new Dropzone("#dropzoneArea", {
    autoProcessQueue: false,       // don't auto-upload
    uploadMultiple: true,
    parallelUploads: 10,
    maxFiles: 20,
    paramName: "product_images",   // must match Django field name
    addRemoveLinks: true
});

document.getElementById("productDropzoneForm").addEventListener("submit", function(e) {
    e.preventDefault(); // stop normal submit

    var form = this;
    var formData = new FormData(form);

    // append Dropzone files into formData
    myDropzone.files.forEach(function(file) {
        formData.append("product_images", file, file.name);
    });

    fetch(form.action, {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log("Success:", data);
        // optionally redirect or show message
    })
    .catch(error => {
        console.error("Error:", error);
    });
});

</script>



{% endblock content %}