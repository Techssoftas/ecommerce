{% extends 'base.html' %} 
{% load static %} 
{% block title %}
Products Create
{% endblock title %} 
{% block content %}

<div class="main-content">

            <div class="page-content">
                <div class="container-fluid">
                    <form action="{% url 'dashboard:product_edit' product.id %}" id="productDropzoneForm" method="post" class="row g-3" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!-- start page title -->
                        <div class="row">

                            <div class="col-12">

                                    {% if messages %}
                                    {% for message in messages %}
                                        <div
                                        class="alert alert-{{ message.tags }} alert-dismissible fade show mb-xl-0 mb-2"
                                        role="alert"
                                        id="alert-{{ forloop.counter }}"
                                        >
                                        <strong>{{ message }}..!</strong>
                                        <button
                                            type="button"
                                            class="btn-close"
                                            data-bs-dismiss="alert"
                                            aria-label="Close"
                                        ></button>
                                        </div>
                                    {% endfor %}
                                    {% endif %}
                                    

                                </div>


                            <div class="col-12 mt-3">
                                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                    <h4 class="mb-sm-0">Edit Product</h4>

                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item">
                                            
                                                <button type="button" class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#AddCategoryModal">
                                                <i class="bi bi-plus-circle align-baseline me-1"></i>
                                                    Add Category
                                                </button>
                                                
                                               
                                            </li>
                                        </ol>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                        
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            
                                            <div class="col-xxl-12">
                                               
                                                    <div class="mb-3">
                                                        <label for="productTitle" class="form-label">Product Title <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" value="{{ product.name }}"  name="name" id="productTitle" placeholder="Enter product title" >
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="productCategories" class="form-label">Categories <span class="text-danger">*</span></label>
                                                        <select class="form-control" name="category" data-choices name="productCategories" id="productCategories" required>
                                                            <option value="">{{ product.name }}</option>
                                                            {% for category in categories %}
                                                                <option value="{{ category.id }}">{{ category.name }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>

                                                    
                                                    <div class="mb-3">
                                                        <label for="shortDecs" class="form-label"> Description <span class="text-danger">*</span></label>
                                                        <textarea class="form-control" name="description"  id="shortDecs" placeholder="Must enter minimum of a 300 characters" rows="8">{{ product.description }}</textarea>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label for="productBrand" class="form-label">Brand <span class="text-danger">*</span></label>
                                                                <input type="text" value="{{ product.brand }}"  name="brand" class="form-control" id="productBrand" placeholder="Enter brand" >
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label for="productBrand" class="form-label">Model name <span class="text-danger">*</span></label>
                                                                <input type="text" name="model_name" value="{{ product.model_name }}" class="form-control" id="productBrand" placeholder="Enter brand" >
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label class="form-label" for="product-price-input">MRP Price <span class="text-danger">*</span></label>
                                                                <div class="input-group has-validation">
                                                                    <span class="input-group-text" id="product-price-addon">₹</span>
                                                                    <input type="number" value="{{ product.mrp }}" class="form-control" name="product_mrp_price" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                                    <div class="invalid-feedback">Please Enter a MRP price.</div>
                                                                </div>
                                                            </div>
                                                        </div><!--end col-->
                                                        <div class="col-lg-6">
                                                            <div class="mb-3">
                                                                <label class="form-label" for="product-price-input">Selling Price <span class="text-danger">*</span></label>
                                                                <div class="input-group has-validation">
                                                                    <span class="input-group-text" id="product-price-addon">₹</span>
                                                                    <input type="number" name="product_selling_price" value="{{ product.price }}" class="form-control" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                                    <div class="invalid-feedback">Please Enter a selling price.</div>
                                                                </div>
                                                            </div>
                                                        </div><!--end col-->
                                                    
                                                    </div>
                                                    
                                                    <div class="row mt-3">
                                                        <div class="col-lg-6">
                                                            <div class="form-check form-switch mb-3">
                                                                <input type="checkbox" name="cod_available" {% if product.is_cod_available %}checked{% endif %} class="form-check-input" id="id_cod_available">
                                                                <label class="form-check-label" for="exchangeableInput">Cod Available</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="form-check form-switch mb-3">
                                                                <input type="checkbox" name="returnable" {% if product.is_returnable %}checked{% endif %} class="form-check-input" id="id_returnable">
                                                                <label class="form-check-label" for="refundableInput">Returnable</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="form-check form-switch mb-3">
                                                                <input type="checkbox" name="free_shipping" {% if product.free_shipping %}checked{% endif %} class="form-check-input" id="id_free_shipping">
                                                                <label class="form-check-label" for="refundableInput">Free Shipping</label>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>
                                                
                                            </div><!--end col-->
                                        </div><!--end row-->
                                    </div>
                                </div>
                            </div><!--end col-->
                        </div><!--end row-->

                    

                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                              <div class="col-xxl-12">
                                                <div class="mb-3">
                                                    <label class="form-label">Product Images <span class="text-danger">*</span></label>

                                                    <!-- Clickable Dropzone -->
                                                    <div class="dropzone text-center" id="dropzoneArea">
                                                        <!-- Hidden file input -->
                                                        <input id="fileInput" name="product_images" type="file" multiple style="display: none;">

                                                        <div class="dz-message needsclick">
                                                            <div class="mb-3">
                                                                <i class="display-4 text-muted ri-upload-cloud-2-fill"></i>
                                                            </div>
                                                            <h4>Drop product images here or click to upload.</h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <ul class="list-unstyled mb-0" id="dropzone-preview">
                                                <li class="mt-2" id="dropzone-preview-list">
                                                    <!-- This is used as the file preview template -->
                                                    <div class="border rounded">
                                                        <div class="d-flex p-2">
                                                            <div class="flex-shrink-0 me-3">
                                                                <div class="avatar-sm bg-light rounded">
                                                                    <img data-dz-thumbnail class="img-fluid rounded d-block" src="assets/images/new-document.png" alt="Dropzone-Image" >
                                                                </div>
                                                            </div>
                                                            <div class="flex-grow-1">
                                                                <div class="pt-1">
                                                                    <h5 class="fs-md mb-1" data-dz-name>&nbsp;</h5>
                                                                    <p class="fs-sm text-muted mb-0" data-dz-size></p>
                                                                    <strong class="error text-danger" data-dz-errormessage></strong>
                                                                </div>
                                                            </div>
                                                            <div class="flex-shrink-0 ms-3">
                                                                <button data-dz-remove class="btn btn-sm btn-danger">Delete</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                            </ul>


                                        <!-- Show existing product images -->
                                        <div class="row mt-3">
                                            {% for img in product.images.all %}
                                                <div class="col-sm-3 col-6 mb-3 image-card" id="image-{{ img.id }}">
                                                    <div class="position-relative border rounded p-1">
                                                        <!-- Delete Button -->
                                                        <button type="button" 
                                                                class="btn btn-sm btn-danger rounded position-absolute top-0 end-0 m-1 delete-image-btn" 
                                                                data-id="{{ img.id }}">
                                                            <i class="bi bi-x-lg"></i>
                                                        </button>
                                                        <!-- Image -->
                                                        <img src="{{ img.image.url }}" 
                                                            alt="{{ product.name }}" 
                                                            class="img-fluid rounded"
                                                            style="height:150px; width:100%; object-fit:contain;">
                                                    </div>
                                                </div>
                                            {% empty %}
                                                <div class="col-12">
                                                    <p>No images available for this product.</p>
                                                </div>
                                            {% endfor %}
                                        </div>

                                </div>
                            </div><!--end col-->
                        </div><!--end row-->
                           
                         <div class="row">
                        
                            <div class="col-lg-12">
                                <div class="">
                                    <div class="">
                                      
                                        <div class="hstack gap-2 justify-content-end mb-3">
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                            <button type="reset" class="btn btn-danger"><i class="ph-x align-middle"></i> Cancel</button>
                                            
                                        </div>


                                    </div>
                                </div>
                                
                            </div><!--end col-->

                            
                        </div><!--end row-->

                    </form>  
                        <div class="row">
                        
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="row">
                                            
                                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                    <h4 class="mb-sm-0">Edit Variant</h4>

                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item">
                                            
                                                <button type="button" class="btn btn-primary " data-bs-toggle="modal" data-bs-target="#AddVariantModal">
                                                <i class="bi bi-plus-circle align-baseline me-1"></i>
                                                    Add Variant
                                                </button>
                                                
                                               
                                            </li>
                                        </ol>
                                    </div>

                                </div>






                                                {% for variant in product.variants.all %}
                                                    <div class="col-xxl-3 col-lg-4 col-md-6">
                                                        <div class="card ribbon-box ribbon-fill">
                                                            {% if variant.discount_percentage > 0 %}
                                                                <div class="ribbon ribbon-danger">Sale</div>
                                                            {% endif %}

                                                            <div class="card-body p-4 m-4">
                                                                <button type="button"
                                                                    class="btn btn-sm btn-icon btn-subtle-danger position-absolute top-0 end-0 m-3 remove-list"
                                                                    data-remove-id="{{ variant.id }}"
                                                                    data-bs-toggle="modal"
                                                                    data-bs-target="#deleteRecordModal">
                                                                    <i class="ph-trash"></i>
                                                                </button>


                                                                <!-- deleteRecordModal -->
                                                                        <div
                                                                            id="deleteRecordModal"
                                                                            class="modal fade zoomIn"
                                                                            tabindex="-1"
                                                                            aria-hidden="true"
                                                                        >
                                                                            <div class="modal-dialog modal-dialog-centered">
                                                                            <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                <button
                                                                                    type="button"
                                                                                    class="btn-close"
                                                                                    id="close-removemodal"
                                                                                    data-bs-dismiss="modal"
                                                                                    aria-label="Close"
                                                                                ></button>
                                                                                </div>
                                                                                <div class="modal-body p-md-5">
                                                                                <div class="text-center">
                                                                                    <div class="text-danger">
                                                                                    <i class="bi bi-trash display-5"></i>
                                                                                    </div>
                                                                                    <div class="mt-4">
                                                                                    <h4 class="mb-2">Are you sure ?</h4>
                                                                                    <p class="text-muted mx-3 mb-0">
                                                                                        Are you sure you want to remove this variant ?
                                                                                    </p>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="d-flex gap-2 justify-content-center mt-4 pt-2 mb-2">
                                                                                    <button
                                                                                    type="button"
                                                                                    class="btn w-sm btn-light btn-hover"
                                                                                    data-bs-dismiss="modal"
                                                                                    >
                                                                                    Close
                                                                                    </button>
                                                                                    <form method="POST" action="{% url 'dashboard:variant_delete' product.id  variant.id %}"   style="display:inline;">
                                                                                        {% csrf_token %}
                                                                                        <button type="submit" class="btn w-sm btn-danger" id="remove-product">Yes, Delete It!</button>
                                                                                    </form>
                                                                                </div>
                                                                                </div>
                                                                            </div>
                                                                            <!-- /.modal-content -->
                                                                            </div>
                                                                            <!-- /.modal-dialog -->
                                                                        </div>
                                                                        <!-- /deleteRecordModal -->


                                                                {% if variant.variant_image %}
                                                                    <img src="{{ variant.variant_image.url }}"
                                                                        alt="{{ variant.variant_value }}"
                                                                        class="img-fluid"
                                                                        style="height: 82px;width: 120px;"/>
                                                                {% else %}
                                                                    <img src="{% static 'dashboard/images/products/img-1.png' %}"
                                                                        alt="{{ product.name }}"
                                                                        class="img-fluid"
                                                                        style="height: 82px;width: 120px;"/>
                                                                {% endif %}
                                                            </div>

                                                            <div class="card-body pt-0">
                                                                {% if product.average_rating > 0 %}
                                                                    <span class="badge bg-warning-subtle text-warning float-end">
                                                                        <i class="bi bi-star-fill align-baseline me-1"></i>
                                                                        <span class="rate">{{ product.average_rating }}</span>
                                                                    </span>
                                                                {% endif %}

                                                                <h5 class="fs-lg mb-3">
                                                                    ₹{{ variant.price }}
                                                                    {% if variant.mrp and variant.discount_percentage > 0 %}
                                                                        <small class="fs-sm fw-normal text-decoration-line-through text-muted">
                                                                            ₹{{ variant.mrp }}
                                                                        </small>
                                                                    {% endif %}
                                                                </h5>


                                                                    {% for size_val in variant.size %}
                                                                        <button type="button" class="btn rounded-pill btn-primary">{{ size_val }}</button>
                                                                    {% endfor %}
                                                                <br>
                                                                <button type="button"
                                                                            class="btn rounded-pill mt-2"
                                                                            style="background-color: {{ variant.hex_color_code }}; border: 1px solid #ccc;">
                                                                    </button>


                                                                <div class="mt-3 hstack gap-2">
                                                                    
                                                                    <a type="button" data-bs-toggle="modal" data-edit-id="{{ variant.id }}" data-bs-target="#EditVariantModal-{{ variant.id }}" class="btn btn-secondary w-100">
                                                                        <i class="ph-pencil me-1 align-middle"></i> Edit
                                                                    </a>


                                                                    <!-- EditVariantModal  --> 
                                                                    <div class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" id="EditVariantModal-{{ variant.id }}" aria-labelledby="EditVariantModal-{{ variant.id }}" aria-hidden="true">
                                                                        <div class="modal-dialog modal-dialog-centered">
                                                                            <div class="modal-content">
                                                                                <div class="modal-body text-center p-5">
                                                                                    <h5 class="mb-3">Edit Variant -  {{variant.variant_value }}</h5>
                                                                                    <form action="{% url 'dashboard:variant_edit' product.id variant.id %}" method="post" class="row g-3" enctype="multipart/form-data">
                                                                                    {% csrf_token %}
                                                                                        <div class="row mt-3">
                                                                                                            
                                                                                            
                                                                                            <div class="col-lg-12">
                                                                                                <div class="mb-3">
                                                                                                    <label class="form-label" for="product-price-input">MRP Price <span class="text-danger">*</span></label>
                                                                                                    <div class="input-group has-validation">
                                                                                                        <span class="input-group-text" id="product-price-addon">₹</span>
                                                                                                        <input type="number" class="form-control" name="variant_mrp_price" value="{{variant.mrp}}" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                                                                        <div class="invalid-feedback">Please Enter a MRP price.</div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div><!--end col-->
                                                                                            <div class="col-lg-12">
                                                                                                <div class="mb-3">
                                                                                                    <label class="form-label" for="product-price-input">Selling Price <span class="text-danger">*</span></label>
                                                                                                
                                                                                                    <div class="input-group has-validation">
                                                                                                        <span class="input-group-text" id="product-price-addon">₹</span>
                                                                                                        
                                                                                                        <input  name="variant_selling_price" class="form-control" value="{{variant.price}}" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                                                                                        <div class="invalid-feedback">Please Enter a selling price.</div>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div><!--end col-->
                                                                                            
                                                                                            <div class="col-lg-12">
                                                                                                <label class="form-label" for="product-price-input">Colors <span class="text-danger">*</span></label>
                                                                                                    
                                                                                                <div class="input-group">
                                                                                                    <label class="input-group-text" for="inputGroupSelect01">Colors</label>
                                                                                                    <select class="form-select" id="inputGroupSelect01" name="variant_value">

                                                                                                        <option value="{{variant.variant_value}}">{{variant.variant_value}}</option>
                                                                                                        <option value="black">Black</option>
                                                                                                        <option value="red">Red</option>
                                                                                                        <option value="green">Green</option>
                                                                                                        <option value="blue">Blue</option>
                                                                                                        <option value="yellow">Yellow</option>
                                                                                                        <option value="orange">Orange</option>
                                                                                                        <option value="purple">Purple</option>
                                                                                                        <option value="pink">Pink</option>
                                                                                                        <option value="white">White</option>
                                                                                                        <option value="gray">Gray</option>
                                                                                                        <option value="brown">Brown</option>
                                                                                                        <option value="violet">Violet</option>
                                                                                                        <option value="indigo">Indigo</option>
                                                                                                        <option value="cyan">Cyan</option>
                                                                                                        <option value="magenta">Magenta</option>
                                                                                                        <option value="gold">Gold</option>
                                                                                                        <option value="silver">Silver</option>
                                                                                                        <option value="beige">Beige</option>
                                                                                                        <option value="maroon">Maroon</option>
                                                                                                        <option value="navy">Navy</option>
                                                                                                        <option value="teal">Teal</option>
                                                                                                        <option value="lime">Lime</option>
                                                                                                        <option value="olive">Olive</option>
                                                                                                    </select>
                                                                                                </div>
                                                                                            </div>
                                                                                            
                                                                                        
                                                                                            <div class="col-lg-12 mt-2">
                                                                                                <div class="mb-3 ">
                                                                                                    <label for="productBrand" class="form-label">Colour Code <span class="text-danger">*</span></label>
                                                                                                    <div class="d-flex align-items-center">
                                                                                                        <input type="color" 
                                                                                                            name="hex_color_code" 
                                                                                                            class="form-control form-control-color w-100 color-picker" 
                                                                                                            id="productColor-{{ variant.id }}" 
                                                                                                            value="{{ variant.hex_color_code }}" required>

                                                                                                        <input type="text" 
                                                                                                            class="form-control color-display" 
                                                                                                            id="colorHexDisplay-{{ variant.id }}" 
                                                                                                            value="{{ variant.hex_color_code }}" readonly 
                                                                                                            style="max-width: 120px;">
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="col-lg-6">
                                                                                                <div class="mb-3 ">
                                                                                                    <label for="sizeInput-{{ variant.id }}" class="form-label">Size <span class="text-danger">*</span></label>
                                                                                                <div class="input-group">
                                                                                                        <input type="text" class="form-control" style="text-transform: uppercase;" id="sizeInput-{{ variant.id }}" aria-label="Recipient's username" aria-describedby="button-addon2">
                                                                                                        <button class="btn btn-info add-size-btn" type="button" data-variant="{{ variant.id }}">Add</button>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="col-lg-6">
                                                                                                <div class="mb-3">
                                                                                                    <label for="productBrand" class="form-label">Selected Size <span class="text-danger">*</span></label>
                                                                                                    <br/>
                                                                                                    <input type="hidden" name="variant_sizes" value="" id="selectedSize-{{ variant.id }}" required>
                                                                                                    <div id="selectedSizeContainer-{{ variant.id }}"></div>
                                                                                                </div>
                                                                                            </div>
                                                                                            
                                                                                            <div class="col-lg-12">
                                                                                                <div class="mb-3">
                                                                                                    <label for="productBrand" class="form-label">Image <span class="text-danger">*</span></label>
                                                                                                    <input type="file" name="variant_image" accept=".png,.jpg,.jpeg" class="form-control" id="productBrand" >
                                                                                                </div>
                                                                                            </div>
                                                                                            

                                                                                            
                                                                                        </div><!--end row-->

                                                                                        <div class="hstack gap-2 justify-content-end mb-3">
                                                                                            <button type="submit" class="btn btn-primary">Submit</button>
                                                                                            <button type="reset" class="btn btn-danger"><i class="ph-x align-middle"></i> Cancel</button>
                                                                                            
                                                                                        </div>
                                                                                    </form>
                                                                                    
                                                                                </div>
                                                                            </div><!-- /.modal-content -->
                                                                        </div><!-- /.modal-dialog -->
                                                                    </div><!-- /.modal -->

                                                                  
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>


                                                     
                                                {% endfor %}
                              

                                            
                                        </div><!--end row-->

                                       
                                    </div>
                                </div>
                                
                            </div><!--end col-->

                            
                        </div><!--end row-->


                        
                  
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
        <!--start back-to-top-->
            <button class="btn btn-dark btn-icon" id="back-to-top">
            <i class="bi bi-caret-up fs-3xl"></i>
            </button>
    <!--end back-to-top-->
        
        </div>
        <!-- end main content-->

<!-- Modal --> 
<div class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" id="AddCategoryModal" aria-labelledby="AddCategoryModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <h5 class="mb-3">Add New Category</h5>
                <form action="{% url 'dashboard:add_category' %}" method="post" class="row g-3" enctype="multipart/form-data">
                {% csrf_token %}
                    <div class="col-md-12">
                        <label for="fullnameInput" class="form-label">Name
                            <span class="text-danger">*</span>
                        </label>
                        <input type="text" class="form-control" id="fullnameInput" name="name" placeholder="Enter name" required>
                    </div>
                               
                    <div class="col-12">
                        <label for="inputAddress" class="form-label">Description</label>
                        <input type="text" class="form-control" name="description" id="inputAddress" placeholder="Description">
                    </div>
                    <div class="col-12">
                        <label for="inputAddress" class="form-label">Image</label>
                        <input type="file" class="form-control" name="image" accept=".png,.jpeg,.jpg" id="inputAddress" >
                    </div>
                    
                    
                    <div class="col-12">
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">Create</button>
                        </div>
                    </div>
                </form>
                
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->




<!-- Modal --> 
<div class="modal fade bs-example-modal-center" tabindex="-1" role="dialog" id="AddVariantModal" aria-labelledby="AddVariantModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <h5 class="mb-3">Add New Variant</h5>
                <form action="{% url 'dashboard:variant_create' product.id %}" method="post" class="row g-3" enctype="multipart/form-data">
                {% csrf_token %}
                     <div class="row mt-3">
                                         
                        
                        <div class="col-lg-12">
                            <div class="mb-3">
                                <label class="form-label" for="product-price-input">MRP Price <span class="text-danger">*</span></label>
                                <div class="input-group has-validation">
                                    <span class="input-group-text" id="product-price-addon">₹</span>
                                    <input type="number" class="form-control" name="variant_mrp_price" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                    <div class="invalid-feedback">Please Enter a MRP price.</div>
                                </div>
                            </div>
                        </div><!--end col-->
                        <div class="col-lg-12">
                            <div class="mb-3">
                                <label class="form-label" for="product-price-input">Selling Price <span class="text-danger">*</span></label>
                                <div class="input-group has-validation">
                                    <span class="input-group-text" id="product-price-addon">₹</span>
                                    <input type="number" name="variant_selling_price" class="form-control" id="product-price-input" placeholder="Enter price" aria-label="Price" aria-describedby="product-price-addon" required>
                                    <div class="invalid-feedback">Please Enter a selling price.</div>
                                </div>
                            </div>
                        </div><!--end col-->
                        
                        <div class="col-lg-12">
                            <label class="form-label" for="product-price-input">Colors <span class="text-danger">*</span></label>
                                
                            <div class="input-group">
                                <label class="input-group-text" for="inputGroupSelect01">Colors</label>
                                <select class="form-select" id="inputGroupSelect01" name="variant_value">

                                    <option value="black">Black</option>
                                    <option value="red">Red</option>
                                    <option value="green">Green</option>
                                    <option value="blue">Blue</option>
                                    <option value="yellow">Yellow</option>
                                    <option value="orange">Orange</option>
                                    <option value="purple">Purple</option>
                                    <option value="pink">Pink</option>
                                    <option value="white">White</option>
                                    <option value="gray">Gray</option>
                                    <option value="brown">Brown</option>
                                    <option value="violet">Violet</option>
                                    <option value="indigo">Indigo</option>
                                    <option value="cyan">Cyan</option>
                                    <option value="magenta">Magenta</option>
                                    <option value="gold">Gold</option>
                                    <option value="silver">Silver</option>
                                    <option value="beige">Beige</option>
                                    <option value="maroon">Maroon</option>
                                    <option value="navy">Navy</option>
                                    <option value="teal">Teal</option>
                                    <option value="lime">Lime</option>
                                    <option value="olive">Olive</option>
                                </select>
                            </div>
                        </div>
                        
                       
                        <div class="col-lg-12 mt-2">
                            <div class="mb-3 ">
                                <label for="productBrand" class="form-label">Colour Code <span class="text-danger">*</span></label>
                                <div class="d-flex align-items-center">
                                    <input type="color" 
                                        name="hex_color_code" 
                                        class="form-control form-control-color w-100 color-picker" 
                                        id="productColor-add" value="#000000" required>

                                    <input type="text" 
                                        class="form-control color-display" 
                                        id="colorHexDisplay-add" 
                                        readonly style="max-width: 120px;">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3 ">
                                <label for="sizeInput-add" class="form-label">Size <span class="text-danger">*</span></label>
                            <div class="input-group">
                                    <input type="text" class="form-control" style="text-transform: uppercase;" id="sizeInput-add" aria-label="Recipient's username" aria-describedby="button-addon2" >
                                    <button class="btn btn-info add-size-btn" type="button" data-variant="add">Add</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                
                                <label for="productBrand" class="form-label">Selected Size <span class="text-danger">*</span></label>
                                <br/>
                                <input type="hidden" name="variant_sizes" id="selectedSize-add" required>
                                <div id="selectedSizeContainer-add"></div>
                            </div>
                        </div>
                        
                         <div class="col-lg-12">
                            <div class="mb-3">
                                <label for="productBrand" class="form-label">Image <span class="text-danger">*</span></label>
                                <input type="file" name="variant_image" accept=".png,.jpg,.jpeg" class="form-control" id="productBrand" placeholder="Enter brand" required>
                            </div>
                        </div>
                        

                        
                    </div><!--end row-->

                    <div class="hstack gap-2 justify-content-end mb-3">
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="reset" class="btn btn-danger"><i class="ph-x align-middle"></i> Cancel</button>
                        
                    </div>
                </form>
                
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->



    <!-- dropzone js -->
    <script src="{% static 'dashboard/libs/dropzone/dropzone-min.js' %}"></script>
    <!-- init js -->
    <script src="{% static 'dashboard/js/pages/ecommerce-create-product.init.js' %}"></script>



<script>
$(document).ready(function () {
    $(".color-picker").each(function () {
        let colorInput = $(this);
        let variantId = this.id.replace("productColor-", ""); // "add" or variant.id
        let colorHexDisplay = $(`#colorHexDisplay-${variantId}`);

        function updateColorCode() {
            let colorVal = colorInput.val();
            colorHexDisplay.val(colorVal);
            colorHexDisplay.css("background-color", colorVal);
            colorHexDisplay.css("color", "#fff");
        }

        updateColorCode(); // init
        colorInput.on("input", updateColorCode);
    });
});


</script>

<!-- Include jQuery if not already included -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    let selectedSizes = { add: [] };

    // Add button click (Add Variant)
    $(".add-size-btn").click(function () {
        let variantId = $(this).data("variant"); // "add" or number
        if (!selectedSizes[variantId]) {
            selectedSizes[variantId] = [];
        }

        let newSize = $(`#sizeInput-${variantId}`).val().trim();
        if (newSize !== "" && !selectedSizes[variantId].includes(newSize)) {
            selectedSizes[variantId].push(newSize);

            // update hidden field
            $(`#selectedSize-${variantId}`).val(selectedSizes[variantId].join(","));

            // show button
            $(`#selectedSizeContainer-${variantId}`).append(`
                <button type="button" class="btn rounded-pill btn-primary m-1">${newSize}</button>
            `);

            $(`#sizeInput-${variantId}`).val("");
        }
    });

    // ✅ Require at least 1 size before form submit
    $("#AddVariantModal form").on("submit", function (e) {
        if (selectedSizes["add"].length === 0) {
            alert("Please add at least one size.");
            e.preventDefault(); // stop submit
        }
    });
});

</script>



<script>
Dropzone.autoDiscover = false; // avoid auto init

var myDropzone = new Dropzone("#dropzoneArea", {
    autoProcessQueue: false,       // don't auto-upload
    uploadMultiple: true,
    parallelUploads: 10,
    maxFiles: 20,
    paramName: "product_images",   // must match Django field name
    addRemoveLinks: true
});

document.getElementById("productDropzoneForm").addEventListener("submit", function(e) {
    e.preventDefault(); // stop normal submit

    var form = this;
    var formData = new FormData(form);

    // append Dropzone files into formData
    myDropzone.files.forEach(function(file) {
        formData.append("product_images", file, file.name);
    });

    fetch(form.action, {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log("Success:", data);
        // optionally redirect or show message
    })
    .catch(error => {
        console.error("Error:", error);
    });
});

</script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).on("click", ".delete-image-btn", function () {
    let imageId = $(this).data("id");
    let imageCard = $("#image-" + imageId);

    Swal.fire({
        title: "Are you sure?",
        text: "Do you really want to delete this image?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6",
        confirmButtonText: "Yes, delete it!"
    }).then((result) => {
        if (result.isConfirmed) {
            const baseUrl = window.location.origin;  
            fetch(`${baseUrl}/product_image/delete/${imageId}/`, {
                method: "DELETE",
                headers: {
                    "X-CSRFToken": getCookie("csrftoken"), // for Django
                    "Content-Type": "application/json"
                }
            })
            .then(response => {
                if (response.ok) {
                    Swal.fire("Deleted!", "Image deleted successfully.", "success");
                    imageCard.remove(); // remove from UI
                } else {
                    Swal.fire("Error!", "Failed to delete image.", "error");
                }
            })
            .catch(() => {
                Swal.fire("Error!", "Something went wrong.", "error");
            });
        }
    });
});

// ✅ Helper function to get CSRF token (for Django)
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

</script>
{% endblock content %}